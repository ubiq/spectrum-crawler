/*
The sync process can be found in hooks.js
These tests are to confirm the sync operated as expected using a sample of 30 blocks
*/
process.env.NODE_ENV = 'test';

let chai = require('chai');
let Block = require('../models/block');
let Transaction = require('../models/transaction');
let SystemStore = require('../models/systemStore');

describe('crawler.js', function() {
  describe('blocks', function() {
    it('it should return block count: 30', function(done) {
      Block.count({}, function(err, blocks) {
        blocks.should.be.eql(30);
        done();
      });
    });
  });
  describe('transactions', function() {
    it('it should return total transaction count: 198', function(done) {
      Transaction.count({}, function(err, transactions) {
        transactions.should.be.eql(198);
        done();
      });
    });
  });
  describe('total supply', function() {
    it('it should return supply: 240250000000000000000', function(done) {
      SystemStore.findOne({symbol: 'UBQ'}, function(err, systemStore) {
        systemStore.supply.should.be.eql('240250000000000000000');
        done();
      });
    });
  });
});

let testTransactions = {
  bittrex: {
    blockHash: "0x1addd8bff607391cc54843d0d5cdd934942c85454859ce650873a076fb14bf9e",
    blockNumber: 155084,
    from: "0xb3c4e9ca7c12a6277deb9eef2dece65953d1c864",
    gas: 191272,
    gasPrice: 24947907840,
    hash: "0x2362a635d31dd82a813686731de8fb149192732b52267e1b01dae0c375ee5bf1",
    input: "0x6ea056a90000000000000000000000004b4899a10f3e507db207b0ee2426029efa168a67000000000000000000000000000000000000000000000000000000001aa8d4a9",
    nonce: 21989,
    r: "0xcc9f862580fad879f50f5b6ffb0321d8183ca1853f8d188ab370981ad36bb073",
    s: "0x4ac7a7556a5ccffca5a441d4a0d6d0473b5d90b932ddc25054b3fb5a8aa4a62e",
    to: "0x0bb0131f5887129acd4d5fa89eb86aea33c15307",
    transactionIndex: 2,
    v: "0x33",
    value: 0
  },
  approve: {
    blockHash: "0x877532b2e257805d4d052fdaceac08eda5e0123875ea6c09240b811e281444b8",
    blockNumber: 155458,
    from: "0xda904bc07fd95e39661941b3f6daded1b8a38c71",
    gas: 128650,
    gasPrice: 20000000000,
    hash: "0x9e205cb64fb500759779bbeca9e7f2ad5a76a6ed8c10f8ea782a0cff13601ee8",
    input: "0x095ea7b300000000000000000000000039f525c45deb2b408993a40793610f5fe4014da500000000000000000000000000000000000000000000000000000002540be400",
    nonce: 13,
    r: "0x9322e3c5b9a01627faf9a5afb60d8791f603793bf205f6d1929a966499973ad",
    s: "0x2619e59f3523cd396a24e2d1a8640d7acbe41969d933be80d7b5d63c57382ceb",
    to: "0x431332520091bfe534478a03d9bc5e70fab2a41a",
    transactionIndex: 2,
    v: "0x33",
    value: 0
  },
  transfer: {
    blockHash: "0xe77316803f62fa36193731efaab8b1a93141bb426c2743ac1a1c6d6eba5e398e",
    blockNumber: 155268,
    from: "0xda904bc07fd95e39661941b3f6daded1b8a38c71",
    gas: 151810,
    gasPrice: 20000000000,
    hash: "0x1efce82ac4a70120e21042d27c810026bb9bf461e40ef74545415da79cd7a40b",
    input: "0xa9059cbb00000000000000000000000039f525c45deb2b408993a40793610f5fe4014da5000000000000000000000000000000000000000000000000000000003b9aca00",
    nonce: 12,
    r: "0x253787d0e9eee750deba68e3b2a46b0fb1e65991756b80f034c174a4f737710",
    s: "0x130fc61ee5440a15a2c65931f2194771fba719fb33cc737f02bb63d38973acbd",
    to: "0x431332520091bfe534478a03d9bc5e70fab2a41a",
    transactionIndex: 4,
    v: "0x34",
    value: 0
  },
  transferFrom: {
    blockHash: "0x4a0dc878847b9abe29855e7f03d6b1431b80f52a6b3b857d3cc219f70f891324",
    blockNumber: 155080,
    from: "0xb3c4e9ca7c12a6277deb9eef2dece65953d1c864",
    gas: 178907,
    gasPrice: 23265082223,
    hash: "0x2bb1e12e4f30c4d84f4226ec997957025c048518d1ca9cdc19db4bb9f89dcf90",
    input: "0x23b872dd00000000000000000000000059e972723d768933691d07135c39d2cd5c43139e000000000000000000000000b3c4e9ca7c12a6277deb9eef2dece65953d1c864000000000000000000000000000000000000000000000000000000001aa8d4a9",
    nonce: 21979,
    r: "0xeb57efab325000423617712c35bff2b990b6001740651bba83e62d80ba8aec14",
    s: "0x4dc5dcd172abf810cf666c086b1c8627cba45226098fa7e7f3aeeb3e97773cd7",
    to: "0x4b4899a10f3e507db207b0ee2426029efa168a67",
    transactionIndex: 34,
    v: "0x34",
    value: 0
  },
  unknown: {
    blockHash: "0xc428a707298e628f27ad8182e9256d78cf2fb821bbcb6a439cbfc3ed3e9180aa",
    blockNumber: 155222,
    from: "0xda904bc07fd95e39661941b3f6daded1b8a38c71",
    gas: 1058856,
    gasPrice: 20000000000,
    hash: "0xc61f806a78db3eccff4c923233b2e03530adf4b1c58ac7603a0254961a3fc0e3",
    input: "0x60a0604052600960608190527f546f6b656e20302e3100000000000000000000000000000000000000000000006080908152600080548180527f546f6b656e20302e310000000000000000000000000000000000000000000012825590927f290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563602060026001851615610100026000190190941693909304601f0192909204820192909190620000d9565b82800160010185558215620000d9579182015b82811115620000d9578251825591602001919060010190620000bc565b5b50620000fd9291505b80821115620000f95760008155600101620000e3565b5090565b505034620000005760405162000db738038062000db7833981016040908152815160208301519183015160608401519193928301929091015b33600160a060020a031660009081526005602090815260408220869055600486905584516001805493819052927fb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf6600282861615610100026000190190921691909104601f908101849004820193880190839010620001c157805160ff1916838001178555620001f1565b82800160010185558215620001f1579182015b82811115620001f1578251825591602001919060010190620001d4565b5b50620002159291505b80821115620000f95760008155600101620000e3565b5090565b50508060029080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200026557805160ff191683800117855562000295565b8280016001018555821562000295579182015b828111156200029557825182559160200191906001019062000278565b5b50620002b99291505b80821115620000f95760008155600101620000e3565b5090565b50506003805460ff191660ff84161790555b505050505b610ad780620002e06000396000f300606060405236156100a95763ffffffff60e060020a60003504166306fdde0381146100ae578063095ea7b31461013b57806318160ddd1461016b57806323b872dd1461018a578063313ce567146101c057806342966c68146101e35780635a3b7e421461020757806370a082311461029457806379cc6790146102bf57806395d89b41146102ef578063a9059cbb1461037c578063cae9ca511461039a578063dd62ed3e1461040e575b610000565b34610000576100bb61043f565b604080516020808252835181830152835191928392908301918501908083838215610101575b80518252602083111561010157601f1990920191602091820191016100e1565b505050905090810190601f16801561012d5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3461000057610157600160a060020a03600435166024356104cc565b604080519115158252519081900360200190f35b34610000576101786104fd565b60408051918252519081900360200190f35b3461000057610157600160a060020a0360043581169060243516604435610503565b604080519115158252519081900360200190f35b34610000576101cd610626565b6040805160ff9092168252519081900360200190f35b346100005761015760043561062f565b604080519115158252519081900360200190f35b34610000576100bb6106bb565b604080516020808252835181830152835191928392908301918501908083838215610101575b80518252602083111561010157601f1990920191602091820191016100e1565b505050905090810190601f16801561012d5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3461000057610178600160a060020a0360043516610749565b60408051918252519081900360200190f35b3461000057610157600160a060020a036004351660243561075b565b604080519115158252519081900360200190f35b34610000576100bb61081b565b604080516020808252835181830152835191928392908301918501908083838215610101575b80518252602083111561010157601f1990920191602091820191016100e1565b505050905090810190601f16801561012d5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3461000057610398600160a060020a03600435166024356108a6565b005b3461000057604080516020600460443581810135601f8101849004840285018401909552848452610157948235600160a060020a031694602480359560649492939190920191819084018382808284375094965061097495505050505050565b604080519115158252519081900360200190f35b3461000057610178600160a060020a0360043581169060243516610a8e565b60408051918252519081900360200190f35b60018054604080516020600284861615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156104c45780601f10610499576101008083540402835291602001916104c4565b820191906000526020600020905b8154815290600101906020018083116104a757829003601f168201915b505050505081565b600160a060020a03338116600090815260066020908152604080832093861683529290522081905560015b92915050565b60045481565b6000600160a060020a038316151561051a57610000565b600160a060020a0384166000908152600560205260409020548290101561054057610000565b600160a060020a038316600090815260056020526040902054828101101561056757610000565b600160a060020a038085166000908152600660209081526040808320339094168352929052205482111561059a57610000565b600160a060020a03808516600081815260056020908152604080832080548890039055878516808452818420805489019055848452600683528184203390961684529482529182902080548790039055815186815291517fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9281900390910190a35060015b9392505050565b60035460ff1681565b600160a060020a0333166000908152600560205260408120548290101561065557610000565b600160a060020a03331660008181526005602090815260409182902080548690039055600480548690039055815185815291517fcc16f5dbb4873280815c1ee09dbd06736cffcc184412cf7a71a0fdb75d397ca59281900390910190a25060015b919050565b6000805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156104c45780601f10610499576101008083540402835291602001916104c4565b820191906000526020600020905b8154815290600101906020018083116104a757829003601f168201915b505050505081565b60056020526000908152604090205481565b600160a060020a0382166000908152600560205260408120548290101561078157610000565b600160a060020a03808416600090815260066020908152604080832033909416835292905220548211156107b457610000565b600160a060020a03831660008181526005602090815260409182902080548690039055600480548690039055815185815291517fcc16f5dbb4873280815c1ee09dbd06736cffcc184412cf7a71a0fdb75d397ca59281900390910190a25060015b92915050565b6002805460408051602060018416156101000260001901909316849004601f810184900484028201840190925281815292918301828280156104c45780601f10610499576101008083540402835291602001916104c4565b820191906000526020600020905b8154815290600101906020018083116104a757829003601f168201915b505050505081565b600160a060020a03821615156108bb57610000565b600160a060020a033316600090815260056020526040902054819010156108e157610000565b600160a060020a038216600090815260056020526040902054818101101561090857610000565b600160a060020a03338116600081815260056020908152604080832080548790039055938616808352918490208054860190558351858152935191937fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef929081900390910190a35b5050565b60008361098181856104cc565b15610a855780600160a060020a0316638f4ffcb1338630876040518563ffffffff1660e060020a0281526004018085600160a060020a0316600160a060020a0316815260200184815260200183600160a060020a0316600160a060020a0316815260200180602001828103825283818151815260200191508051906020019080838360008314610a2c575b805182526020831115610a2c57601f199092019160209182019101610a0c565b505050905090810190601f168015610a585780820380516001836020036101000a031916815260200191505b5095505050505050600060405180830381600087803b156100005760325a03f11561000057505050600191505b5b509392505050565b6006602090815260009283526040808420909152908252902054815600a165627a7a72305820115b7a0af0b5931428ca484b7f5b6573a9dadafd05e876cc5ce4dc7cb2deb9bc0029000000000000000000000000000000000000000000000000000000174876e8000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000d556269717363616e20546573740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000045445535400000000000000000000000000000000000000000000000000000000",
    nonce: 9,
    r: "0x9f48ec236a895d3ab76cab693cd9067677a9a8ca315a96185f057e8df04057c4",
    s: "0xa1e05fa180eb4024902c93dd412a74473f1eeba442ed453cfba1154e4f4bec9",
    to: null,
    transactionIndex: 3,
    v: "0x34",
    value: 0
  }
}
